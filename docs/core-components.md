# 核心组件规则

本文档定义了茶叶批发OA-IM集成项目的核心组件及其职责。

## 系统组件架构

系统采用"IM为中心"的架构模式，主要由以下核心组件组成：

```
┌────────────────────────────────────────────────────────────────┐
│                          Mattermost平台                         │
│                                                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌────────┐ │
│  │             │  │             │  │             │  │        │ │
│  │  订单管理应用 │  │  库存管理应用 │  │  审批流程应用 │  │ 报表应用│ │
│  │             │  │             │  │             │  │        │ │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └────┬───┘ │
│         │                │                │               │    │
└─────────┼────────────────┼────────────────┼───────────────┼────┘
          │                │                │               │
          │                │                │               │
          ▼                ▼                ▼               ▼
┌────────────────────────────────────────────────────────────────┐
│                                                                │
│                     OA-IM集成服务(Node.js)                      │
│                                                                │
└─────────────────────────────┬──────────────────────────────────┘
                              │
                              ▼
                 ┌─────────────────────────┐
                 │                         │
                 │  SQLite/PostgreSQL数据库 │
                 │                         │
                 └─────────────────────────┘
```

## 核心组件说明

### 1. Mattermost应用

这些应用在Mattermost平台上运行，为用户提供直接的交互界面。

- **订单管理应用:** 创建、查询、处理茶叶订单
- **库存管理应用:** 查询库存、预警管理、仓库管理
- **审批流程应用:** 处理各类业务审批
- **报表应用:** 业务数据可视化展示

### 2. OA-IM集成服务

后端服务组件，处理业务逻辑和数据存储。

- **控制器层:** 处理HTTP请求、参数验证、返回响应
- **服务层:** 实现业务逻辑、数据处理
- **数据模型层:** 定义数据结构、数据关系
- **工具和中间件:** 提供通用功能、请求处理中间件

### 3. 数据存储

- **SQLite:** 轻量级部署 (<500用户)
- **PostgreSQL:** 大型部署 (>500用户)
- **Sequelize ORM:** 数据库操作抽象

### 4. 消息队列

- **better-queue:** 内存队列 (轻量级部署)
- **Bull+Redis:** 分布式队列 (大型部署)
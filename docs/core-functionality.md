# 核心功能实现规则

本文档定义了茶叶批发OA-IM集成项目的核心功能实现方式。

## 1. 订单管理功能

### 订单创建流程

订单创建是系统最基础的功能，实现了从Mattermost内直接创建茶叶批发订单。

- **订单表单:** 通过Mattermost应用框架提供订单创建表单
- **库存检查:** 验证选择的库存是否充足
- **价格计算:** 自动计算订单总金额
- **提成计算:** 根据库存类型计算业务员提成
- **通知推送:** 发送订单创建通知到相关人员

### 订单审批流程

- **自动审批路由:** 根据订单特征自动判断审批路径
- **审批通知:** 向审批人发送通知
- **一键审批:** 在通知中直接完成审批操作
- **审批追踪:** 记录完整审批历史

## 2. 库存与提成管理

### 多仓库库存管理

系统支持跨多个仓库的库存管理，包括仓库间调拨。

- **仓库切换:** 支持按仓库位置筛选库存
- **库存类型:** 支持业务员货、公司货、冰中岛货三种类型
- **库存转换:** 业务员货超过15天自动转为公司货
- **库存预警:** 库存低于阈值时自动发送预警

### 提成计算

基于利润的提成计算，针对不同库存类型有不同提成比例：

- **业务员货:** 利润的15%
- **公司货:** 利润的0.01%
- **冰中岛货:** 利润的20%

## 3. IM平台集成

### 通知与消息推送

系统能够将订单、库存、审批等状态更新推送到Mattermost频道或直接消息。

- **频道通知:** 业务事件推送到指定频道
- **直接消息:** 个人任务通知发送到私信
- **交互式按钮:** 消息中包含可操作按钮
- **状态更新:** 自动更新消息状态

### Mattermost应用集成

- **应用框架集成:** 使用Mattermost Apps Framework创建原生应用
- **命令集成:** 提供斜杠命令快速访问功能
- **表单集成:** 提供交互式表单

## 4. 自动化任务

- **库存转换检查:** 每天检查并转换超过15天的业务员货
- **库存预警检查:** 定期检查库存并发送预警通知
- **数据同步:** 确保多系统数据一致性
- **报表生成:** 自动生成销售、库存报表